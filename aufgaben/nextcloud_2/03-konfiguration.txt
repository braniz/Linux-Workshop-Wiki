====== 03 - Web-Setup und Konfiguration ======

===== Lernziele =====

Nach dieser Lektion haben Sie:
  * Nextcloud √ºber die Web-Oberfl√§che eingerichtet
  * Administrator-Konto erstellt und konfiguriert
  * Datenbank-Verbindung hergestellt
  * Grundlegende Sicherheitseinstellungen vorgenommen

===== Web-Setup starten =====

**1. IP-Adresse des Servers ermitteln:**
<code>
hostname -I
# oder
ip addr show | grep "inet " | grep -v 127.0.0.1
</code>

**2. Browser √∂ffnen und Nextcloud aufrufen:**

<WRAP center round info 70%>
**üåê Nextcloud im Browser √∂ffnen:**

**Lokaler Zugriff:**
  * `http://localhost/nextcloud`

**Netzwerk-Zugriff:**
  * `http://[IHRE-SERVER-IP]/nextcloud`
  * Beispiel: `http://192.168.1.100/nextcloud`
</WRAP>

**3. Setup-Seite sollte erscheinen:**

Sie sollten die Nextcloud-Installationsseite sehen mit Feldern f√ºr:
  * Administrator-Benutzername
  * Administrator-Passwort
  * Datenverzeichnis
  * Datenbank-Konfiguration

===== Administrator-Konto erstellen =====

**Administrator-Zugangsdaten eingeben:**

^ Feld ^ Wert (Schulungsumgebung) ^
| **Benutzername** | Admin |
| **Passwort** | Start1234 |

<WRAP center round tip 70%>
**üí° Schulungshinweis:**

Verwenden Sie exakt diese Zugangsdaten, damit alle Workshop-Teilnehmer die gleichen Einstellungen haben.

**F√ºr Produktionsumgebungen:**
  * Benutzername: Nicht "admin" oder vorhersagbar
  * Passwort: Mindestens 12 Zeichen, Sonderzeichen, Zahlen
</WRAP>

===== Datenverzeichnis konfigurieren =====

**Standard-Datenverzeichnis:**
<code>
/var/www/html/nextcloud/data
</code>

**Empfehlung:** Belassen Sie das Standardverzeichnis f√ºr diese Schulung.

**F√ºr Produktionsumgebungen** k√∂nnten Sie ein separates Verzeichnis verwenden:
<code>
/var/nextcloud-data
# oder
/opt/nextcloud-data
</code>

===== Datenbank-Konfiguration =====

**Datenbank-Typ ausw√§hlen:**
  * MySQL/MariaDB ausw√§hlen (nicht SQLite f√ºr Produktionsumgebungen)

**Datenbank-Zugangsdaten eingeben:**

^ Feld ^ Wert ^
| **Datenbankbenutzer** | nc_user |
| **Datenbankpasswort** | nc_pass |
| **Datenbankname** | nextcloud |
| **Datenbankhost** | localhost |

**Port:** Leer lassen (verwendet Standard-Port 3306)

===== Installation durchf√ºhren =====

**1. "Installation fertigstellen" klicken**

Die Installation dauert typischerweise 30-60 Sekunden.

**2. M√∂gliche Meldungen w√§hrend der Installation:**
  * "Datenbank wird eingerichtet..."
  * "Dateien werden kopiert..."
  * "Apps werden installiert..."

**3. Bei erfolgreicher Installation:**
  * Weiterleitung zur Nextcloud-Hauptseite
  * Anmeldung mit Admin/Start1234

===== Erste Anmeldung =====

**1. Nach der Installation automatische Anmeldung oder:**
<code>
Benutzername: Admin
Passwort: Start1234
</code>

**2. Willkommens-Tour (optional):**
  * Sie k√∂nnen die Tour durchgehen oder √ºberspringen
  * Alle Features werden sp√§ter erkl√§rt

**3. Desktop und Mobile Apps:**
  * √úberspringen Sie vorerst die App-Installation
  * Focus liegt auf Server-Konfiguration

===== Erste Sicherheits√ºberpr√ºfung =====

**Administrations-Einstellungen aufrufen:**
  1. Rechts oben auf Benutzer-Avatar klicken
  2. "Einstellungen" ausw√§hlen
  3. Links im Men√º "Verwaltung" ‚Üí "√úbersicht"

**Typische Warnungen beim ersten Start:**

<WRAP center round important 80%>
**‚ö†Ô∏è Erwartete Sicherheitswarnungen:**

Diese Warnungen sind normal und werden in den n√§chsten Lektionen behoben:

  * **HTTP anstatt HTTPS** - Sicherheitsproblem
  * **PHP-Speicherlimit** - Performance-Problem  
  * **Caching nicht konfiguriert** - Performance-Problem
  * **Fehlende PHP-Module** - Funktionalit√§tsprobleme
  * **Well-known URLs** - Kompatibilit√§tsproblem

**‚û°Ô∏è Diese werden in Lektion 04 (Optimierung) behandelt.**
</WRAP>

===== Grundlegende Konfiguration =====

**1. Grundeinstellungen anpassen:**

Gehen Sie zu: **Einstellungen** ‚Üí **Verwaltung** ‚Üí **Grundeinstellungen**

**Email-Server (optional f√ºr Schulung):**
  * Vorerst leer lassen
  * In Produktionsumgebungen: SMTP-Server konfigurieren

**Telefonregion einstellen:**
  * **Standard-Telefonregion:** DE (Deutschland)
  * F√ºr andere L√§nder entsprechenden ISO-Code verwenden

**2. Benutzer-Standardeinstellungen:**

Gehen Sie zu: **Einstellungen** ‚Üí **Verwaltung** ‚Üí **Benutzer**

**Standard-Gruppe:** Belassen auf "users"
**Standard-Speicherkontingent:** Vorerst "Unbegrenzt" f√ºr Schulung

===== Grundlegende Apps aktivieren =====

**Empfohlene Apps f√ºr den Workshop:**

Gehen Sie zu: **Einstellungen** ‚Üí **Apps**

**Bereits aktiviert (Standard):**
  * Files (Dateien)
  * Activity (Aktivit√§ten)
  * Photos (Fotos)
  * Text (Text-Editor)

**Zus√§tzlich aktivieren (empfohlen):**
  * Calendar (Kalender)
  * Contacts (Kontakte)
  * Notes (Notizen)

**Apps deaktivieren (optional, f√ºr bessere Performance):**
  * Talk (Video-Chat) - ressourcenintensiv
  * Office Apps - ben√∂tigen zus√§tzliche Server

===== Test-Benutzer erstellen =====

**F√ºr Workshop-Zwecke einen Test-Benutzer anlegen:**

Gehen Sie zu: **Einstellungen** ‚Üí **Verwaltung** ‚Üí **Benutzer**

**Neuen Benutzer hinzuf√ºgen:**
^ Feld ^ Wert ^
| **Benutzername** | testuser |
| **Anzeigename** | Test User |
| **Passwort** | test123 |
| **Gruppe** | users |
| **Speicherkontingent** | 1 GB |

===== Erste Funktionalit√§tstests =====

**1. Datei-Upload testen:**
  * Gehen Sie zu "Dateien"
  * Laden Sie eine kleine Testdatei hoch
  * √úberpr√ºfen Sie ob Upload funktioniert

**2. Ordner erstellen:**
  * Erstellen Sie einen neuen Ordner "Workshop"
  * √úberpr√ºfen Sie Berechtigungen

**3. Teilen testen:**
  * Klicken Sie auf eine Datei
  * Testen Sie die Teilen-Funktion
  * Erstellen Sie einen √∂ffentlichen Link

**4. Mit Test-Benutzer anmelden:**
  * Abmelden vom Admin-Account
  * Anmelden als "testuser" / "test123"
  * Grundfunktionen testen
  * Wieder als Admin anmelden

===== Backup der Konfiguration =====

**Wichtige Dateien sichern:**
<code>
# Nextcloud-Konfiguration
sudo cp /var/www/html/nextcloud/config/config.php /home/backup-config.php

# Datenbank sichern
mysqldump -u nc_user -p nextcloud > /home/backup-nextcloud.sql
# Passwort: nc_pass

# Berechtigungen pr√ºfen
ls -la /var/www/html/nextcloud/config/config.php
</code>

===== H√§ufige Setup-Probleme =====

**Problem 1: "Internal Server Error" beim Setup**
<code>
# Apache-Logs pr√ºfen:
sudo tail -f /var/log/apache2/error.log

# H√§ufige Ursachen:
# - Falsche Berechtigungen
# - PHP-Fehler
# - Datenbank-Verbindung fehlgeschlagen
</code>

**L√∂sung - Berechtigungen korrigieren:**
<code>
sudo chown -R www-data:www-data /var/www/html/nextcloud/
sudo chmod -R 755 /var/www/html/nextcloud/
sudo systemctl restart apache2
</code>

**Problem 2: Datenbank-Verbindung fehlgeschlagen**
<code>
# Datenbank-Zugang testen:
mysql -u nc_user -p nextcloud
# Passwort: nc_pass

# Falls Fehler: Benutzer-Rechte pr√ºfen
mysql -u root -p
SHOW GRANTS FOR 'nc_user'@'localhost';
</code>

**Problem 3: Setup-Seite l√§dt nicht**
<code>
# Webserver-Status pr√ºfen:
sudo systemctl status apache2

# Nextcloud-Dateien pr√ºfen:
ls -la /var/www/html/nextcloud/index.php

# Curl-Test:
curl -v http://localhost/nextcloud/
</code>

**Problem 4: PHP-Fehler im Setup**
<code>
# PHP-Fehlerlog pr√ºfen:
sudo tail -f /var/log/apache2/error.log

# PHP-Konfiguration pr√ºfen:
php --ini

# Module pr√ºfen:
php -m | grep -E "(mysql|xml|gd|curl)"
</code>

===== Konfigurationsdatei verstehen =====

**Nach dem Setup: config.php pr√ºfen**
<code>
sudo cat /var/www/html/nextcloud/config/config.php
</code>

**Wichtige Konfigurationsparameter:**
<code>
<?php
$CONFIG = array (
  'instanceid' => 'abc123def456',           // Eindeutige Instanz-ID
  'passwordsalt' => 'xyz789...',            // Passwort-Salt
  'secret' => 'secret123...',               // Geheimer Schl√ºssel
  'trusted_domains' => array (              // Erlaubte Domains
    0 => 'localhost',
    1 => '192.168.1.100',
  ),
  'datadirectory' => '/var/www/html/nextcloud/data',  // Datenverzeichnis
  'dbtype' => 'mysql',                      // Datenbank-Typ
  'version' => '30.0.2.1',                 // Nextcloud-Version
  'overwrite.cli.url' => 'http://localhost/nextcloud',  // CLI-URL
  'dbname' => 'nextcloud',                 // Datenbank-Name
  'dbhost' => 'localhost',                 // Datenbank-Host
  'dbuser' => 'nc_user',                   // Datenbank-Benutzer
  'dbpassword' => 'nc_pass',               // Datenbank-Passwort
  'installed' => true,                     // Installation abgeschlossen
);
</code>

===== Checkliste Web-Setup =====

**Nach dem Setup pr√ºfen:**

  * ‚òê Nextcloud l√§dt ohne Fehler (`http://[SERVER-IP]/nextcloud`)
  * ‚òê Admin-Anmeldung funktioniert (Admin/Start1234)
  * ‚òê Datenbank-Verbindung ist hergestellt
  * ‚òê Dateien k√∂nnen hochgeladen werden
  * ‚òê Test-Benutzer wurde erstellt und funktioniert
  * ‚òê Grundlegende Apps sind aktiviert
  * ‚òê Konfigurationsdatei ist erstellt (`config.php`)
  * ‚òê Administrations-√úbersicht zeigt Status an
  * ‚òê Backup der Konfiguration wurde erstellt

===== Weiter zur Optimierung =====

**üéâ Grundkonfiguration abgeschlossen!**

Nextcloud ist jetzt funktionsf√§hig, aber noch nicht optimiert. Die Administrations-√úbersicht zeigt wahrscheinlich mehrere Warnungen.

üëâ **[[aufgaben:nextcloud_2:04-optimierung|04 - Performance-Optimierung und Fehlerbehebung]]**

**In der n√§chsten Lektion werden wir:**
  * Alle Sicherheitswarnungen beheben
  * Performance-Optimierungen durchf√ºhren
  * Caching konfigurieren
  * PHP und Apache fine-tunen
  * Wartungsfenster einrichten

===== Zus√§tzliche Tests =====

**Erweiterte Funktionalit√§tstests:**
<code>
# Nextcloud-Kommandozeilen-Tool (OCC) testen:
cd /var/www/html/nextcloud
sudo -u www-data php occ check

# Status pr√ºfen:
sudo -u www-data php occ status

# Benutzer auflisten:
sudo -u www-data php occ user:list
</code>

**Browser-Tests:**
  * Upload gro√üer Dateien (>10MB)
  * Ordner-Navigation
  * Datei-Vorschau (Bilder, PDFs)
  * Teilen-Funktionalit√§t
  * Mobile-responsive Design testen

**Netzwerk-Tests (falls mehrere Rechner verf√ºgbar):**
  * Zugriff von anderem Computer im Netzwerk
  * Gleichzeitige Anmeldung mehrerer Benutzer
  * Datei-Synchronisation testen
